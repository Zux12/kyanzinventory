<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>KYANZ – Total Sales</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #0b0f14;
      color: #e9eef6;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .box {
      background: #111826;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 14px;
      padding: 28px 32px;
      min-width: 280px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,.5);
    }

    h1 {
      margin: 0 0 14px;
      font-size: 18px;
      letter-spacing: .3px;
    }

    .amount {
      font-size: 32px;
      font-weight: 800;
      margin: 10px 0;
    }

    .meta {
      font-size: 13px;
      color: #9fb0c7;
      margin-top: 6px;
    }

    .error {
      margin-top: 14px;
      color: #ff6b6b;
      font-size: 13px;
      display: none;
    }

    button {
      margin-top: 18px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 0;
      cursor: pointer;
      font-weight: 700;
      background: #25D366;
      color: #0b1f12;
    }

    button:active {
      transform: scale(.97);
    }
  </style>
</head>

<body>
  <div class="box">
    <h1>KYANZ – Total Sales</h1>

    <div class="amount" id="total">—</div>
    <div class="meta" id="orders">—</div>
    <div class="meta" id="updated">—</div>

    <button onclick="load()">Refresh</button>

    <div class="error" id="error"></div>
  </div>

  <script>
    async function load() {
      const totalEl = document.getElementById("total");
      const ordersEl = document.getElementById("orders");
      const updatedEl = document.getElementById("updated");
      const errorEl = document.getElementById("error");

      errorEl.style.display = "none";
      totalEl.textContent = "Loading…";
      ordersEl.textContent = "";

      try {
        const res = await fetch("/api/summary/total-sales", { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();

        totalEl.textContent = `${data.currency} ${Number(data.totalSales).toFixed(2)}`;
        ordersEl.textContent = `Paid orders: ${data.paidOrders}`;
        updatedEl.textContent = "Updated: " + new Date().toLocaleString();

      } catch (err) {
        totalEl.textContent = "—";
        ordersEl.textContent = "";
        updatedEl.textContent = "";
        errorEl.textContent = "Failed to load total sales";
        errorEl.style.display = "block";
        console.error(err);
      }
    }

    load();
  </script>
</body>
</html>
